<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | Rental Book System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
<link href="/css/datatable-custom.css" rel="stylesheet">
<link href="/css/datatable-toolbar.css" rel="stylesheet">
<link href="/css/datatable-responsive-fix.css" rel="stylesheet">
<link href="/css/sidebar-transition.css" rel="stylesheet">
<link href="/css/sidebar-transition-override.css" rel="stylesheet">
<link href="/css/sidebar-mini.css" rel="stylesheet">
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
</head>
<body>
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <% if (staffId) { %>
    <div class="bg-dark border-end" id="sidebar-wrapper">
        <div class="sidebar-heading text-white py-4 px-3 fs-4 fw-bold border-bottom">Library Staff</div>
        <div class="list-group list-group-flush my-3">
            <a href="/" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-speedometer2 me-2"></i><span class="sidebar-text">Dashboard</span></a>
            <a href="/books" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-book me-2"></i><span class="sidebar-text">Books</span></a>
            <a href="/members" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-people me-2"></i><span class="sidebar-text">Members</span></a>
            <a href="/rentals" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-arrow-left-right me-2"></i><span class="sidebar-text">Rentals/Returns</span></a>
            <a href="/reports/history" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-bar-chart me-2"></i><span class="sidebar-text">Reports</span></a>
            <% if (staffRole === 'admin') { %>
            <a href="/staff" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-person-gear me-2"></i><span class="sidebar-text">Staff</span></a>
            <a href="/audit" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-clipboard-data me-2"></i><span class="sidebar-text">Audit Logs</span></a>
            <% } %>
            <a href="/settings" class="list-group-item list-group-item-action bg-dark text-white"><i class="bi bi-gear me-2"></i><span class="sidebar-text">Settings</span></a>
        </div>
    </div>
    <% } %>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper" class="w-100">
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <div class="container-fluid">
                <% if (staffId) { %>
                <button class="btn btn-outline-dark" id="sidebarToggle"><i class="bi bi-list"></i></button>
                <span class="ms-auto">
                    Logged in as <strong><%= staffName %></strong> (<%= staffRole %>)
                    <a href="/auth/logout" class="btn btn-link">Logout</a>
                </span>
                <% } %>
            </div>
        </nav>
        <div class="container-fluid mt-4">
            <%- body %>
        </div>
    </div>
    <!-- /#page-content-wrapper -->

    <!-- Global Modal for Add/Edit -->
    <div class="modal fade" id="mainModal" tabindex="-1" aria-labelledby="mainModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="mainModalLabel">Loading...</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="text-center text-secondary py-5">Loading form...</div>
          </div>
        </div>
      </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="/js/datatable-init.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/sweetalert-delete.js"></script>
<script src="/js/modal-ajax.js"></script>
<script src="/js/sidebar.js"></script>
<% if (typeof success !== 'undefined' && success) { %>
<script>
Swal.fire({ icon: 'success', title: 'Success', text: '<%= success %>' });
</script>
<% } %>
<% if (typeof error !== 'undefined' && error) { %>
<script>
Swal.fire({ icon: 'error', title: 'Error', text: '<%= error %>' });
</script>
<% } %>
</body>
</html>
